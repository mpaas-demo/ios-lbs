window.AlipayH5Keyboad||function(){var t,e=function(t){if(t&&t.nodeType){for(var e=t;e;){if("fixed"==window.getComputedStyle(e).position)return!0;if(e===document||e===document.documentElement||e===document.body)break;e=e.parentNode}return!1}},a="data-kb-placeholder";function r(t){"undefined"!=typeof AlipayJSBridge?t():document.addEventListener("AlipayJSBridgeReady",function(){t()})}var n=-1!=navigator.userAgent.search(/iPhone OS 10_(1|2)/gi);window.SHOULDH5CUSTOMKEYBOARDRUNSPVERSION&&(n=!1);var o=-1!==navigator.userAgent.search("Nebula WK");function i(){if(window.SHOULDUESH5KEYBOARD){if(document.addEventListener("focus",function(a){var r=a.target,i=r.getAttribute("data-keyboard"),u=r.type;if(t=null,r&&("input"==r.tagName.toLowerCase()||"textarea"==r.tagName.toLowerCase())&&i&&""!=i&&(t=r,o)){var l=!1;n&&!e(r)?l=!0:n||(l=!0),"password"==u&&(l=!1),l&&r._sourceBlur&&(window.AlipayJSBridge&&AlipayJSBridge.call("updateNativeKeyBoardInput",{BLURFROMH5:"BLURFROMH5"}),r._sourceBlur())}},!0),o){var a=null,i=250;-1!=navigator.userAgent.search(/iPhone\sOS\s(10|9|8)_(1|2)/gi)&&(i=300),window.addEventListener("resize",function(e){t&&r(function(){clearTimeout(a),a=setTimeout(function(){var e=l.getInputParamWithElement(t,!0);if(e){var a=JSON.parse(e);AlipayJSBridge.call("resizeNativeKeyBoardInput",a)}},i)})}),window.addEventListener("scroll",function(e){t&&r(function(){clearTimeout(a),a=setTimeout(function(){var e=l.getInputParamWithElement(t,!0);if(e){var a=JSON.parse(e);AlipayJSBridge.call("resizeNativeKeyBoardInput",a)}},i)})}),function(){if(window.SHOULDUESMUTATIONOBSERVER){var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,a=document.querySelector("body");new e(function(e){t&&r(function(){var e=t.parentNode;if(e&&"string"==typeof e.className&&/a-input-wrap/.test(e.className)){var a="1.0",r=document.querySelector("meta[name=viewport]");if(r){var n=r.getAttribute("content");n&&(a=n.match(/initial-scale=\s*([0-9.]+)/)[1])}parseFloat(a);var o=parseFloat(window.getComputedStyle(t).borderWidth),i=parseFloat(window.getComputedStyle(t).borderLeftWidth),u=parseFloat(window.getComputedStyle(t).borderRightWidth),l=parseFloat(window.getComputedStyle(t).borderTopWidth),d=window.AlipayH5Keyboad._getEleOffset(e);o&&o>0&&(d.x=d.x+i||o,d.y=d.y+l||o,d.yt=d.yt+l||o,u&&(d.w-=u),i&&(d.w-=i));var s={RESIZEACTION:"SETFRAME"};s.offset=d,AlipayJSBridge.call("updateNativeKeyBoardInput",s)}})}).observe(a,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["class","style"]})}}()}var u=HTMLInputElement.prototype.blur;HTMLInputElement.prototype.blur=function(){var t=this.getAttribute("data-keyboard");return t&&""!=t&&r(function(){AlipayJSBridge.call("hideCustomKeyBoard")}),u.apply(this,arguments)},HTMLInputElement.prototype._sourceBlur=u;var d=HTMLTextAreaElement.prototype.blur;HTMLTextAreaElement.prototype.blur=function(){var t=this.getAttribute("data-keyboard");return t&&""!=t&&r(function(){AlipayJSBridge.call("hideCustomKeyBoard")}),d.apply(this,arguments)},HTMLTextAreaElement.prototype._sourceBlur=d}}var u=1,l={_getOffset:function(t){var e=document.getElementsByClassName("h5numInput")[t];return this._getEleOffset(e)},getInputOffset:function(t){return JSON.stringify(this._getOffset(t))},_getEleOffset:function(t){var e=document.querySelector("meta[name=viewport]").getAttribute("content").match(/initial-scale=\s*([0-9.]+)/)[1],a=parseFloat(e),r=window.getComputedStyle(t).paddingLeft;return"center"==window.getComputedStyle(t).textAlign&&(r=0),{x:(parseFloat(r)+t.getBoundingClientRect().left)*a,y:(t.getBoundingClientRect().top+document.body.scrollTop)*a,yt:t.getBoundingClientRect().top*a,w:(t.offsetWidth-parseFloat(r))*a,h:t.offsetHeight*a}},getInputParam:function(t){var e=document.getElementsByClassName("h5numInput")[t];e.setAttribute("readonly","true"),e.setAttribute("placeholder","");var a,r=e.getAttribute("h5kb-color"),n=window.getComputedStyle(e).color;r&&r.length?a=r:(a=n,e.setAttribute("h5kb-color",n));var o=parseFloat(window.getComputedStyle(e).fontSize);e.style.color=window.getComputedStyle(e).backgroundColor;var i=document.querySelector("meta[name=viewport]").getAttribute("content").match(/initial-scale=\s*([0-9.]+)/)[1],u=parseFloat(i);return{offset:this._getOffset(t),placeholder:this.getPlaceholder(t),type:e.getAttribute("type")||"text",kbType:e.getAttribute("kb-type")||e.getAttribute("data-kb-type")||0,value:e.value||"",color:a,fontSize:o*u,fontWeight:window.getComputedStyle(e).fontWeight,maxlength:parseInt(e.getAttribute("maxlength"))||-1,canPaste:!("false"==e.getAttribute("data-paste")),textAlign:window.getComputedStyle(e).textAlign}},dispatchEventWithElement:function(t,e,a,r,n,o,i){if(t)if("blur"==e){var u=new FocusEvent("blur");if(u.initEvent("blur",!1,!1),u.simulated=!0,t.dispatchEvent(u),r&&"r"==r){var l=function(t,e){if(t&&t.nodeType){for(var a=t;a;){if(a.tagName&&a.tagName.toLowerCase()==e)return a;if(a===document||a===document.documentElement||a===document.body)break;a=a.parentNode}return null}}(t,"form");l&&l.submit&&l.submit()}window._currentInput=null}else if("keydown"==e){(d=new KeyboardEvent("keydown",{keyCode:a||0})).data={keyCode:a||0},d.initEvent("keydown",!1,!1),t.dispatchEvent(d)}else if("keyup"==e){var d;(d=new KeyboardEvent("keyup",{keyCode:a||0})).data={keyCode:a||0},d.initEvent("keyup",!1,!1),t.dispatchEvent(d)}else if("input"==e){if(r&&""!=r||46==a){var s=new Event("input",{bubbles:!0,cancelable:!1});s.data=r,s.simulated=!0,s.marked="Y"==n,o&&(s.markedstart=o.start,s.markedlength=o.length),i&&"object"==typeof i&&i.hasOwnProperty("cursor")&&(s.cursor=i.cursor),t.dispatchEvent(s)}}else if("change"==e){var c=new Event("change",{bubbles:!0,cancelable:!1});t.dispatchEvent(c)}else if("complete"==e){var g=new Event("complete",{bubbles:!0,cancelable:!1});i&&i.value&&(g.data={value:i.value}),t.dispatchEvent(g)}else if("linechange"==e){var p=new Event("linechange",{bubbles:!0,cancelable:!1});i&&i.lineCount&&i.height&&(p.data={lineCount:i.lineCount,height:i.height}),t.dispatchEvent(p)}},getTagName:function(e){var a;if(!(!(a=t||e)||a&&a.tagName&&"input"!=a.tagName.toLowerCase()&&"textarea"!=a.tagName.toLowerCase()))return JSON.stringify({tagName:a.tagName.toLowerCase()})},getInputParamWithElement:function(r,i){var l;if(!(!(l=t||r)||l&&l.tagName&&"input"!=l.tagName.toLowerCase()&&"textarea"!=l.tagName.toLowerCase()||e(l)&&n&&o)){var d=l.getAttribute("data-keyboard");if(!d)return window._currentInput=null,"input"==l.tagName.toLowerCase()||"textarea"==l.tagName.toLowerCase()?JSON.stringify({isNoNeedKeyBoardInput:"YES"}):void 0;if(l&&"password"==l.type)return JSON.stringify({isNoNeedKeyBoardInput:"YES"});"idcard"!=d&&"digit"!=d||setTimeout(function(){i||l.setAttribute("type","text")},0),window._currentInput=l;var s=l.getAttribute("h5kb-color"),c=l.getAttribute("placeholder");c&&""!=c&&!i&&(l.setAttribute(a,c),l.placeholder="");var g,p=window.getComputedStyle(l).color,m=l.style.color;s&&s.length?g=s:(g=p,setTimeout(function(){i||(l.setAttribute("h5kb-color",p),m&&""!=m&&null!=m&&(l.setAttribute("isStyleColor",!0),l.setAttribute("isStyleColorVal",m)))},0));var y=parseFloat(window.getComputedStyle(l).fontSize),f=window.getComputedStyle(l).fontFamily;i||(l.style.color=window.getComputedStyle(l).backgroundColor);var b=l.getAttribute("data-kbel-id");b||(b=u++,setTimeout(function(){l.setAttribute("data-kbel-id",b)},0));var w=document.querySelector("meta[name=viewport]").getAttribute("content").match(/initial-scale=\s*([0-9.]+)/)[1],h=parseFloat(w),v=parseFloat(window.getComputedStyle(l).borderWidth),A=parseFloat(window.getComputedStyle(_currentInput).borderLeftWidth),S=parseFloat(window.getComputedStyle(_currentInput).borderRightWidth),E=parseFloat(window.getComputedStyle(_currentInput).borderTopWidth),C=this._getEleOffset(l);v&&v>0&&(C.x=C.x+A||v,C.y=C.y+E||v,C.yt=C.yt+E||v,S&&(C.w-=S),A&&(C.w-=A));var N=c;N||(N=l.getAttribute(a)?l.getAttribute(a):"");var B={tagName:l.tagName.toLowerCase(),position:e(l)?"fixed":"static",offset:C,placeholder:N,type:l.getAttribute("type")||"text",keyboard:l.getAttribute("data-keyboard"),value:l.value||"",color:g,fontSize:y*h,fontFamily:f,fontWeight:window.getComputedStyle(l).fontWeight,lineHeight:window.getComputedStyle(l).lineHeight,maxlength:parseInt(l.getAttribute("maxlength"))||-1,canPaste:!("false"==l.getAttribute("data-paste")),textAlign:window.getComputedStyle(l).textAlign,selectionStart:parseFloat(l.getAttribute("data-selection-start")?l.getAttribute("data-selection-start"):"-1"),selectionEnd:parseFloat(l.getAttribute("data-selection-end")?l.getAttribute("data-selection-end"):"-1"),returnType:l.getAttribute("data-return-type")?l.getAttribute("data-return-type"):"",canReturn:l.getAttribute("data-return")?l.getAttribute("data-return"):"Y",randomNumber:l.getAttribute("data-randomnumber")?l.getAttribute("data-randomnumber"):"N",cursor:parseFloat(l.getAttribute("data-cursor")?l.getAttribute("data-cursor"):"-1"),kbElId:b,controlled:l.getAttribute("data-controlled")?l.getAttribute("data-controlled"):"N"};return"textarea"==B.tagName&&(B.autoHeight=!!l.getAttribute("data-auto-height")&&!("false"==l.getAttribute("data-auto-height")),B.cursorSpacing=parseFloat(l.getAttribute("data-cursor-spacing")?l.getAttribute("data-cursor-spacing"):"0")*h,B.position=e(l)&&"true"==l.getAttribute("data-fixed")?"fixed":"static",B.adjustPosition=l.getAttribute("data-adjust-position")?l.getAttribute("data-adjust-position"):"Y",B.showConfirmBar=l.getAttribute("data-show-confirm-bar")?l.getAttribute("data-show-confirm-bar"):"Y"),JSON.stringify(B)}},setTextareaValue:function(t){window._currentInput.value=t.replace(/\\n/,"\n")},restoreInputElement:function(e){var r=document.querySelector("[data-kbel-id='"+e+"']");if(r){1==r.getAttribute("isStyleColor")?r.style.color=r.getAttribute("h5kb-color"):r.style.color=null;var n=r.getAttribute(a);n&&""!=n&&(r.removeAttribute(a),r.placeholder=n),r.removeAttribute("h5kb-color"),r.removeAttribute("isStyleColor")}else console.error("::data-kbel-id::",e);t=null},getPlaceholder:function(t){return document.getElementsByClassName("h5numInput")[t].getAttribute("data-placeholder")||""},setInputValue:function(t,e){var a=document.getElementsByClassName("h5numInput")[t];a&&(a.value=e)},fixWKFixElementScrollBug:function(){document.addEventListener("touchmove",function(t){r(function(){AlipayJSBridge.call("hideCustomKeyBoard")})},!0)},init:function(){for(var t=[],e=document.getElementsByClassName("h5numInput"),a=0;a<e.length;a++)t.push(this.getInputParam(a));(t.length>0&&("undefined"!=typeof AlipayJSBridge?AlipayJSBridge.call("createInput",{param:t}):document.addEventListener("AlipayJSBridgeReady",function(){AlipayJSBridge.call("createInput",{param:t})})),document.addEventListener("getNewOffset",function(t,e){var a=this._getOffset(index);AlipayJSBridge.callback&&AlipayJSBridge.callback({clientId:e,offset:a})}),window.SHOULDUESH5KEYBOARD)&&(-1!==navigator.userAgent.search("Nebula WK")&&l.fixWKFixElementScrollBug())},_getInputJsonWithElement:function(t){var e=l.getInputParamWithElement(t,!0);try{e&&(e=JSON.parse(e))}catch(t){console.error("json transform error:",t,e)}return e}};document.addEventListener("AlipayJSBridgeReady",function(){l.init()});/complete|loaded|interactive/.test(document.readyState)?setTimeout(function(){i()},1):document.addEventListener("DOMContentLoaded",function(){i()},!1),l.version="1.5.1",window.AlipayH5Keyboad=l}();